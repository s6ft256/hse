<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0, viewport-fit=cover">
  <title>Enhanced HSE Inspection Report System</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë∑</text></svg>">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // User state
    let currentUser = null;
    
    // Update user profile in sidebar
    function updateUserProfile(user) {
      const userProfile = document.getElementById('userProfile');
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      
      if (user) {
        userAvatar.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%236c757d"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>';
        userName.textContent = user.name || 'User';
        userProfile.style.display = 'flex';
      } else {
        userProfile.style.display = 'none';
      }
    }
    
    // Enable all tabs after successful authentication
    function enableAllTabs() {
      const tabs = document.querySelectorAll('.tab-disabled');
      tabs.forEach(tab => {
        tab.classList.remove('tab-disabled');
      });
    }
    
    // Sign out function
    function signOut() {
      // Clear user data
      localStorage.removeItem('assessorData');
      currentUser = null;
      
      // Reset UI
      document.getElementById('authContainer').style.display = 'block';
      document.getElementById('assessorManagement').style.display = 'none';
      document.getElementById('assessorForm').reset();
      updateUserProfile(null);
      
      // Disable all tabs except Assessor
      const tabs = document.querySelectorAll('.nav-link:not(#assessor-tab)');
      tabs.forEach(tab => {
        if (!tab.classList.contains('tab-disabled')) {
          tab.classList.add('tab-disabled');
        }
      });
      
      // Switch back to Assessor tab
      const assessorTab = document.getElementById('assessor-tab');
      const tab = new bootstrap.Tab(assessorTab);
      tab.show();
    }
    
    // Save assessor information
    function saveAssessorInfo() {
      const assessorName = document.getElementById('assessorName').value.trim();
      const assessorId = document.getElementById('assessorId').value.trim();
      const department = document.getElementById('department').value;
      const certification = document.getElementById('certification').value;
      
      if (!assessorName || !assessorId || !department || !certification) {
        alert('Please fill in all required fields');
        return;
      }
      
      // Save assessor data
      const assessorData = {
        name: assessorName,
        id: assessorId,
        department: department,
        certification: certification
      };
      
      localStorage.setItem('assessorData', JSON.stringify(assessorData));
      currentUser = { ...assessorData };
      
      // Update UI
      document.getElementById('authContainer').style.display = 'none';
      document.getElementById('assessorManagement').style.display = 'block';
      updateUserProfile(assessorData);
      enableAllTabs();
      
      // Update inspector dropdown in the inspection form
      updateInspectorDropdown(assessorName);
      
      alert('Assessor information saved successfully!');
    }
    
    // Update inspector dropdown with the current assessor's name
    function updateInspectorDropdown(assessorName) {
      const inspectorSelect = document.getElementById('inspector');
      if (inspectorSelect) {
        // Clear existing options except the first one
        while (inspectorSelect.options.length > 1) {
          inspectorSelect.remove(1);
        }
        
        // Add the assessor's name as an option and select it
        const option = new Option(assessorName, assessorName, false, true);
        inspectorSelect.add(option);
      }
    }
    
    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Check for existing assessor data
      const savedAssessor = localStorage.getItem('assessorData');
      if (savedAssessor) {
        currentUser = JSON.parse(savedAssessor);
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('assessorManagement').style.display = 'block';
        updateUserProfile(currentUser);
        enableAllTabs();
        
        // Update inspector dropdown with saved assessor name
        updateInspectorDropdown(currentUser.name);
      }
      
      // Initialize date field with current date
      const dateField = document.getElementById('date');
      if (dateField) {
        dateField.value = new Date().toISOString().split('T')[0];
      }
      
      // Initialize other components...
    });
  </script>
  <style>
    :root {
      --bg-main: #f8f9fb;
      --bg-card: rgba(255,255,255,0.85);
      --bg-menu: rgba(255,255,255,0.45);
      --text-main: #1a1a1a;
      --text-link: #1976d2;
      --text-link-hover: #004ba0;
      --shadow-main: 0 4px 24px rgba(0,0,0,0.08);
      --primary-color: #1976d2;
      --danger-color: #dc3545;
      --success-color: #28a745;
      --warning-color: #ffc107;
    }

    /* Dark theme variables */
    [data-theme="dark"] {
      --bg-main: #121212;
      --bg-card: rgba(30, 30, 30, 0.9);
      --bg-menu: rgba(40, 40, 40, 0.8);
      --text-main: #f0f0f0;
      --text-link: #64b5f6;
      --text-link-hover: #90caf9;
      --shadow-main: 0 4px 24px rgba(0, 0, 0, 0.3);
    }

    body {
      background: linear-gradient(135deg, #e0e7ff 0%, #d1e0fd 100%);
      min-height: 100vh;
      font-family: 'Roboto', sans-serif;
      color: var(--text-main);
      -webkit-backdrop-filter: blur(16px);
      backdrop-filter: blur(16px);
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Main Layout */
    .main-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .glass-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 1.5rem;
      width: calc(100% - 2rem);
      max-width: 1620px;
      margin: 1rem auto;
      box-shadow: var(--shadow-main);
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeIn 1s ease-in-out;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow-x: hidden;
    }

    .glass-card:hover {
      transform: scale(1.01);
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.25);
    }

    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
    }
    
    h2 {
      position: relative;
      padding-bottom: 10px;
      margin-bottom: 25px;
    }
    
    h2:after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      height: 3px;
      width: 60px;
      background: var(--primary-color);
      border-radius: 3px;
    }
    
    .card-title {
      font-weight: 600;
    }

    /* Side Menu */
    .side-menu {
      position: relative;
      left: 0;
      top: 0;
      height: 100%;
      min-width: 220px;
      max-width: 250px;
      background: var(--bg-menu);
      box-shadow: 2px 0 16px rgba(71, 20, 20, 0.08);
      z-index: 1040;
      padding: 1rem 0.5rem;
      border-radius: 20px 0 0 20px;
      transition: all 0.3s ease;
      overflow-y: auto;
    }

    .menu-heading {
      color: var(--primary-color);
      font-weight: 700;
      font-size: 1.25rem;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .nav-link {
      color: var(--text-main) !important;
      transition: all 0.3s ease;
      margin-bottom: 8px;
      border-radius: 8px;
      text-align: left;
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      padding: 0.75rem 1rem;
    }

    .nav-link.active, .nav-link:focus {
      background: var(--primary-color);
      color: white !important;
      box-shadow: 0 4px 12px rgba(6, 50, 94, 0.3);
    }

    .nav-link:hover {
      background: rgba(6, 50, 94, 0.1);
      transform: scale(1.05);
    }

    /* Content Area */
    .tab-content {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      min-height: 0;
      width: 100%;
    }

    /* Form Elements */
    .form-control, .form-select {
      border-radius: 12px;
      transition: all 0.3s ease;
      padding: 0.75rem 1rem;
      font-family: 'Roboto', sans-serif;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .form-control:focus, .form-select:focus {
      box-shadow: 0 0 0 0.25rem rgba(6, 50, 94, 0.25);
      border-color: #86b7fe;
    }

    textarea.form-control {
      resize: vertical;
      min-height: 120px;
      max-height: 300px;
    }

    label {
      font-weight: 500;
      margin-bottom: 0.5rem;
      font-family: 'Montserrat', sans-serif;
    }

    /* Buttons */
    .btn {
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
      letter-spacing: 0.5px;
    }

    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-primary:hover {
      background-color: #1565c0;
      border-color: #1565c0;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(6, 50, 94, 0.3);
    }
    
    .btn-outline-primary {
      border-width: 2px;
    }

    /* Observation Cards */
    .observation-card {
      opacity: 0;
      transform: translateY(30px);
      animation: observationFadeIn 0.7s cubic-bezier(0.23, 1, 0.32, 1) forwards;
      margin-bottom: 1.5rem;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      border: none;
    }

    .observation-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .badge {
      font-weight: 500;
      padding: 0.5em 0.8em;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
    }

    /* Google Sheets Embed */
    .sheet-container {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: 75%;
      overflow: hidden;
      border-radius: 12px;
      background: rgba(255,255,255,0.1);
      margin: 1rem 0;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.05);
    }

    .sheet-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* Equipment Tabs */
    .equipment-tabs-container {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.05);
      margin-top: 1rem;
    }
    
    .nav-tabs {
      border-bottom: 2px solid rgba(0,0,0,0.08);
      margin-bottom: 1.5rem;
    }
    
    .nav-tabs .nav-link {
      border: none;
      border-radius: 12px 12px 0 0;
      margin-bottom: -2px;
      padding: 0.8rem 1.5rem;
      font-weight: 500;
      color: var(--text-main);
    }
    
    .nav-tabs .nav-link.active {
      background: var(--primary-color);
      color: white !important;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .nav-tabs .nav-link:hover:not(.active) {
      background: rgba(6, 50, 94, 0.1);
    }
    
    .tab-pane h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      color: var(--primary-color);
    }

    /* About Me Section */
    .profile-img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border: 3px solid var(--primary-color);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1976d2;
      margin: 0 auto 1.5rem;
    }
    
    .social-links {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 1.5rem;
    }
    
    .social-links .btn {
      margin: 0;
      min-width: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .list-group-item {
      background: transparent;
      border: none;
      padding: 0.75rem 1.25rem;
      font-family: 'Roboto', sans-serif;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes observationFadeIn {
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes tabPop {
      0% { transform: scale(0.8); }
      60% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* Responsive Adjustments */
    @media (max-width: 992px) {
      .side-menu {
        min-width: 200px;
      }
      
      .glass-card {
        padding: 1.25rem;
      }
    }

    @media (max-width: 768px) {
      .d-flex.flex-row {
        flex-direction: column;
      }
      
      .side-menu {
        max-width: 100%;
        height: auto;
        max-height: 200px;
        border-radius: 20px 20px 0 0;
        margin-bottom: 1rem;
      }
      
      .tab-content {
        padding: 1rem;
      }
      
      .social-links {
        flex-direction: column;
        align-items: center;
      }
    }

    @media (max-width: 576px) {
      .glass-card {
        padding: 1rem;
        margin: 0.75rem auto;
        width: calc(100% - 1.5rem);
      }
      
      .profile-img {
        width: 120px;
        height: 120px;
      }
      
      .social-links .btn {
        width: 100%;
      }
      
      .nav-tabs .nav-link {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
    }
    
    /* Theme Toggle Button */
    .theme-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      border: none;
      box-shadow: var(--shadow-main);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .theme-toggle i {
      transition: transform 0.3s ease;
    }

    [data-theme="dark"] .glass-card,
    [data-theme="dark"] .glass-link {
      background: var(--bg-card);
      color: var(--text-main);
    }

    [data-theme="dark"] .card,
    [data-theme="dark"] .form-control,
    [data-theme="dark"] .form-select {
      background-color: var(--bg-card);
      color: var(--text-main);
      border-color: #444;
    }

    [data-theme="dark"] .form-control:focus,
    [data-theme="dark"] .form-select:focus {
      background-color: var(--bg-card);
      color: var(--text-main);
      border-color: var(--primary-color);
    }
    
    [data-theme="dark"] body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }
    
    [data-theme="dark"] h2:after {
      background: var(--text-link);
    }
    
    /* Plant & Equipment custom styling */
    .plant-equipment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .equipment-description {
      background: rgba(6, 50, 94, 0.08);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }
    
    .equipment-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--primary-color);
      margin: 0.5rem 0;
      font-family: 'Montserrat', sans-serif;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: var(--text-main);
      opacity: 0.8;
    }
    
    .equipment-section {
      margin-bottom: 2rem;
    }
    
    .equipment-section h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    [data-theme="dark"] .equipment-section h3 {
      border-bottom: 1px solid rgba(6, 50, 94, 0.1);
    }
    
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .equipment-item {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }
    
    .equipment-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    
    .equipment-icon {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }
    
    .equipment-info {
      margin-top: 0.5rem;
    }
    
    /* Authentication Styles */
    .auth-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      text-align: center;
    }
    
    .auth-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--shadow-main);
      backdrop-filter: blur(10px);
      max-width: 400px;
      width: 100%;
    }
    
    .embedded-content {
      width: 100%;
      height: 600px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      margin: 20px 0;
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0.5rem 1rem;
      background: var(--bg-card);
      border-radius: 25px;
      margin-bottom: 1rem;
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      margin-left: auto;
    }
    
    .tab-disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    
    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 0.25rem 0;
      border-bottom: 1px dashed rgba(0,0,0,0.1);
    }
    
    [data-theme="dark"] .info-item {
      border-bottom: 1px dashed rgba(6, 50, 94, 0.1);
    }
    
    .info-label {
      font-weight: 500;
    }
    
    .info-value {
      font-weight: 500;
      color: var(--primary-color);
    }
    
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-top: 0.5rem;
      display: inline-block;
    }
    
    .status-active {
      background: rgba(40, 167, 69, 0.15);
      color: #28a745;
    }
    
    .status-inactive {
      background: rgba(220, 53, 69, 0.15);
      color: #dc3545;
    }
    
    .status-maintenance {
      background: rgba(255, 193, 7, 0.15);
      color: #ffc107;
    }
    
    /* Profile icon styling */
    .profile-icon {
      font-size: 4rem;
      color: white;
    }
    
    /* Image preview styles */
    .img-preview-container {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 10px 10px 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.2s ease-in-out;
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      display: inline-block;
    }
    
    .img-preview-container:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .img-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    .file-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 10px;
      background: #f8f9fa;
    }
    
    /* Image modal styles */
    #imageModal .modal-content {
      background-color: #f8f9fa;
      border: none;
      box-shadow: 0 5px 30px rgba(0,0,0,0.2);
    }
    
    #imageModal .modal-header {
      border-bottom: 1px solid #e9ecef;
      background-color: #fff;
    }
    
    #imageModal .modal-footer {
      border-top: 1px solid #e9ecef;
      background-color: #fff;
    }
    
    #modalImage {
      max-height: 70vh;
      max-width: 100%;
      margin: 0 auto;
      display: block;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    /* Dark theme adjustments for image previews */
    [data-theme="dark"] .img-preview-container {
      background-color: #2d2d2d;
      border-color: #444;
    }
    
    [data-theme="dark"] .file-preview {
      background-color: #2d2d2d;
      color: #f0f0f0;
    }
    
    [data-theme="dark"] #imageModal .modal-content {
      background-color: #1e1e1e;
      color: #f0f0f0;
    }
    
    [data-theme="dark"] #imageModal .modal-header,
    [data-theme="dark"] #imageModal .modal-footer {
      background-color: #252525;
      border-color: #444;
    }
    
    /* Stats counters */
    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-item {
      flex: 1;
      min-width: 200px;
      background: var(--bg-card);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin: 5px 0;
    }
    
    .stat-title {
      font-size: 0.9rem;
      color: var(--text-main);
      opacity: 0.8;
    }
    
    /* Login form */
    .login-container {
      max-width: 500px;
      margin: 0 auto;
      padding: 30px;
      background: var(--bg-card);
      border-radius: 15px;
      box-shadow: var(--shadow-main);
    }
    
    .chart-container {
      height: 300px;
      margin: 30px 0;
    }
    
    .chart-wrapper {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body data-theme="light">
  <div class="main-container">
    <div class="glass-card">
      <div class="d-flex flex-row flex-grow-1" style="min-height: 0; position: relative; overflow-y: auto;">
        <!-- Side Menu -->
        <div class="side-menu nav flex-column nav-pills" id="hseTabs" role="tablist" aria-orientation="vertical">
          <div class="menu-heading">MENU</div>
          <!-- User Profile Display (when logged in) -->
          <div id="userProfile" class="user-profile" style="display: none;">
            <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
            <span id="userName"></span>
            <button class="logout-btn" onclick="signOut()">Logout</button>
          </div>
          
          <button class="nav-link active" id="assessor-tab" data-bs-toggle="pill" data-bs-target="#assessor" type="button" role="tab">
            <i class="bi bi-person-badge me-2"></i>Assessor/Inspector
          </button>
          <button class="nav-link tab-disabled" id="inspection-tab" data-bs-toggle="pill" data-bs-target="#inspection" type="button" role="tab">
            <i class="bi bi-clipboard-check me-2"></i>Inspection Report
          </button>
          <button class="nav-link tab-disabled" id="observations-tab" data-bs-toggle="pill" data-bs-target="#observations" type="button" role="tab">
            <i class="bi bi-eye me-2"></i>Observations
          </button>
          <button class="nav-link tab-disabled" id="p2411-tab" data-bs-toggle="pill" data-bs-target="#p2411" type="button" role="tab">
            <i class="bi bi-folder me-2"></i>P2411_Folder
          </button>
          <button class="nav-link tab-disabled" id="plant-equipment-tab" data-bs-toggle="pill" data-bs-target="#plant_equipment" type="button" role="tab">
            <i class="bi bi-tools me-2"></i>Plant & Equipment
          </button>
          <button class="nav-link tab-disabled" id="aboutme-tab" data-bs-toggle="pill" data-bs-target="#aboutme" type="button" role="tab">
            <i class="bi bi-person-circle me-2"></i>ABOUT ME
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content flex-grow-1" id="hseTabContent">
          <!-- Assessor/Inspector Tab (Now First and Active) -->
          <div class="tab-pane fade show active" id="assessor" role="tabpanel">
            <h2><i class="bi bi-person-badge me-2"></i>Assessor/Inspector Authentication</h2>
            
            <!-- Authentication Container -->
            <div id="authContainer" class="text-center py-5">
              <div class="card p-4 mx-auto" style="max-width: 500px;">
                <div class="card-body">
                  <h4 class="mb-4">Enter your assessor details to continue</h4>
                  <button class="btn btn-primary" onclick="document.getElementById('assessorManagement').style.display = 'block'; document.getElementById('authContainer').style.display = 'none';">
                    <i class="bi bi-person-plus me-2"></i>Enter Assessor Information
                  </button>
                  <div class="mt-3 text-center">
                    <small class="text-muted">By continuing, you agree to our terms of service and privacy policy.</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Assessor Management (Shown after authentication) -->
            <div id="assessorManagement" style="display: none;">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="assessorName" class="form-label">Assessor Name</label>
                  <input type="text" class="form-control" id="assessorName" placeholder="Enter your name" required>
                </div>
                <div class="col-md-6">
                  <label for="assessorId" class="form-label">Assessor ID</label>
                  <input type="text" class="form-control" id="assessorId" placeholder="Enter your ID" required>
                </div>
                <div class="col-md-6">
                  <label for="department" class="form-label">Department</label>
                  <select class="form-select" id="department" required>
                    <option disabled selected value="">Select Department</option>
                    <option value="HSE">HSE</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Operations">Operations</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Quality">Quality</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="certification" class="form-label">Certification Level</label>
                  <select class="form-select" id="certification" required>
                    <option disabled selected value="">Select Level</option>
                    <option value="Level 1">Level 1 - Basic</option>
                    <option value="Level 2">Level 2 - OFFICER</option>
                    <option value="Level 3">Level 3 - ENGNEER</option>
                    <option value="Level 4">Level 4 - MANAGER</option>
                  </select>
                </div>
                <div class="col-12">
                  <button type="button" class="btn btn-success w-100" onclick="saveAssessorInfo()">
                    <i class="bi bi-check-circle me-2"></i>Save & Continue
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Inspection Report Tab -->
          <div class="tab-pane fade" id="inspection" role="tabpanel">
            <h2><i class="bi bi-clipboard-check me-2"></i>HSE Inspection Report</h2>
            <form id="hseForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="location" class="form-label">Location</label>
                  <input type="text" class="form-control" id="location" placeholder="Enter inspection location" required>
                </div>
                <div class="col-md-6">
                  <label for="date" class="form-label">Date</label>
                  <input type="date" class="form-control" id="date" required>
                </div>
                <div class="col-md-6">
                  <label for="risk" class="form-label">Risk Level</label>
                  <select class="form-select" id="risk" required>
                    <option disabled selected value="">Select risk level</option>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="responsible" class="form-label">Responsible Engineer</label>
                  <select class="form-select" id="responsible" required onchange="handleResponsibleChange()">
                    <option disabled selected value="">Select Engineer</option>
                    <option value="Rameez">Rameez</option>
                    <option value="Rashad">Rashad</option>
                    <option value="Elaya">Elaya</option>
                    <option value="Martin">Martin</option>
                    <option value="write_custom">‚úèÔ∏è Write name</option>
                  </select>
                  <input type="text" class="form-control mt-2" id="customResponsible" placeholder="Enter engineer name" style="display: none;">
                </div>
                <div class="col-md-6">
                  <label for="inspector" class="form-label">Inspector Name</label>
                  <select class="form-select" id="inspector" required>
                    <option disabled selected value="">Select Inspector</option>
                  </select>
                </div>
                <div class="col-12">
                  <label for="observation" class="form-label">Observation</label>
                  <textarea class="form-control" id="observation" placeholder="Describe your observation in detail..." required></textarea>
                </div>
                <div class="col-12">
                  <label for="photo" class="form-label">Upload Photo</label>
                  <input type="file" class="form-control" id="photo" accept="image/*" multiple>
                  <div class="form-text">Maximum 5 photos (5MB each)</div>
                </div>
                <div class="col-12 mt-4">
                  <button type="submit" class="btn btn-primary w-100 py-2">
                    <i class="bi bi-send-check me-2"></i>Submit Report
                  </button>
                </div>
              </div>
            </form>
          </div>



          <!-- Observations Tab -->
          <div class="tab-pane fade" id="observations" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-eye me-2"></i>Observation Records</h2>
              <button class="btn btn-outline-primary" id="exportObservations">
                <i class="bi bi-download me-2"></i>Export
              </button>
            </div>
            
            <div class="stats-container">
              <div class="stat-item">
                <div class="stat-number" id="totalObservations">0</div>
                <div class="stat-title">Total Observations</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="highRiskCount">0</div>
                <div class="stat-title">High Risk</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="mediumRiskCount">0</div>
                <div class="stat-title">Medium Risk</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="lowRiskCount">0</div>
                <div class="stat-title">Low Risk</div>
              </div>
            </div>
            
            <div class="chart-wrapper">
              <h4><i class="bi bi-bar-chart me-2"></i>Risk Distribution</h4>
              <div class="chart-container">
                <canvas id="riskChart"></canvas>
              </div>
            </div>
            
            <div class="chart-wrapper">
              <h4><i class="bi bi-people me-2"></i>Inspector Activity</h4>
              <div class="chart-container">
                <canvas id="inspectorChart"></canvas>
              </div>
            </div>
            
            <div id="observationsList" class="row g-3"></div>
          </div>

          <!-- P2411 Folder Tab -->
          <div class="tab-pane fade" id="p2411" role="tabpanel">
            <h2><i class="bi bi-folder me-2"></i>P2411 Folders</h2>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="card h-100 glass-link">
                  <div class="card-body text-center">
                    <i class="bi bi-file-earmark-slides text-primary" style="font-size: 2.5rem;"></i>
                    <h5 class="card-title mt-3">My Slides</h5>
                    <a href="https://drive.google.com/drive/folders/1-vAprXj8w3IRDTFlJCxpw7ToXw6JBJ46?usp=sharing" 
                       class="stretched-link" target="_blank"></a>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card h-100 glass-link">
                  <div class="card-body text-center">
                    <i class="bi bi-crane text-primary" style="font-size: 2.5rem;"></i>
                    <h5 class="card-title mt-3">Lifting Documents</h5>
                    <a href="https://drive.google.com/drive/folders/16Q6tteBqG-PpqHms8JO37r0swvu1X8vX?usp=sharing" 
                       class="stretched-link" target="_blank"></a>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card h-100 glass-link">
                  <div class="card-body text-center">
                    <i class="bi bi-shield-check text-primary" style="font-size: 2.5rem;"></i>
                    <h5 class="card-title mt-3">Safety Concerns</h5>
                    <a href="https://drive.google.com/drive/folders/1COg6s8vb-e6ZXM__Zgd55qHZtP1m5fAV?usp=sharing" 
                       class="stretched-link" target="_blank"></a>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card h-100 glass-link">
                  <div class="card-body text-center">
                    <i class="bi bi-gear text-primary" style="font-size: 2.5rem;"></i>
                    <h5 class="card-title mt-3">Plant Equipment</h5>
                    <a href="https://drive.google.com/drive/folders/1Kc_Gv7B9qYdODP-iHMZWETbtXSNPByDe?usp=sharing" 
                       class="stretched-link" target="_blank"></a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Plant & Equipment Tab -->
          <div class="tab-pane fade" id="plant_equipment" role="tabpanel">
            <div class="plant-equipment-header">
              <h2><i class="bi bi-tools me-2"></i>Plant & Equipment Management</h2>
              <a href="https://docs.google.com/spreadsheets/d/1lsrJyzX-57JSUTn258ELYLT15-N8t5OS/edit?usp=sharing" 
                 class="btn btn-outline-primary" target="_blank">
                <i class="bi bi-box-arrow-up-right me-1"></i>Open in Sheets
              </a>
            </div>
            
            <div class="equipment-description">
              <p class="mb-0">This section provides comprehensive management of plant and equipment used in HSE operations. Track maintenance schedules, inspection records, and equipment status in real-time.</p>
            </div>
            
            <div class="equipment-stats">
              <div class="stat-card">
                <div class="stat-value">95</div>
                <div class="stat-label">Total Equipment</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">18</div>
                <div class="stat-label">Active Equipment</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">0</div>
                <div class="stat-label">Under Maintenance</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">02</div>
                <div class="stat-label">Requires Inspection</div>
              </div>
            </div>
            
            <div class="equipment-tabs-container">
              <ul class="nav nav-tabs mb-4" id="equipmentTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="plant-equipment-tab" data-bs-toggle="tab" data-bs-target="#plant-equipment" type="button" role="tab">
                    <i class="bi bi-tools me-1"></i>Plant Equipment
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="power-machines-tab" data-bs-toggle="tab" data-bs-target="#power-machines" type="button" role="tab">
                    <i class="bi bi-gear-fill me-1"></i>Power Machines
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="fire-extinguishers-tab" data-bs-toggle="tab" data-bs-target="#fire-extinguishers" type="button" role="tab">
                    <i class="bi bi-fire me-1"></i>Fire Safety
                  </button>
                </li>
              </ul>
              
              <div class="tab-content" id="equipmentTabsContent">
                <div class="tab-pane fade show active" id="plant-equipment" role="tabpanel">
                  <h3>Plant Equipment Overview</h3>
                  <div class="equipment-grid">
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-crane"></i>
                      </div>
                      <h4>MOBILE CRANE</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">EQ-0012</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Last Inspection:</span>
                          <span class="info-value">2023-10-15</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Next Due:</span>
                          <span class="info-value">2024-01-15</span>
                        </div>
                        <span class="status-badge status-active">Active</span>
                      </div>
                    </div>
                    
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-truck-flatbed"></i>
                      </div>
                      <h4>SKID STEER LOADER</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">EQ-0034</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Last Inspection:</span>
                          <span class="info-value">2023-11-20</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Next Due:</span>
                          <span class="info-value">2024-02-20</span>
                        </div>
                        <span class="status-badge status-active">Active</span>
                      </div>
                    </div>
                    
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-cone-striped"></i>
                      </div>
                      <h4>WHEEL LOADER</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">EQ-0078</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Last Inspection:</span>
                          <span class="info-value">2023-09-10</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Next Due:</span>
                          <span class="info-value">2023-12-10</span>
                        </div>
                        <span class="status-badge status-maintenance">Maintenance</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="sheet-container">
                    <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRxgJP6jRVZLno0cG-6AcOwveisbYHeKTXWZY2tmQ6q2GZVomVFFtIQvVxbZVoKhw/pubhtml?gid=1199586761&single=true"
                            allowfullscreen title="Plant Equipment Log"></iframe>
                  </div>
                </div>
                
                <div class="tab-pane fade" id="power-machines" role="tabpanel">
                  <h3>Power Machines</h3>
                  <div class="equipment-grid">
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-lightning-charge"></i>
                      </div>
                      <h4>GENERATOR 500KVA</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">PM-0021</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Last Inspection:</span>
                          <span class="info-value">2023-11-05</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Next Due:</span>
                          <span class="info-value">2024-02-05</span>
                        </div>
                        <span class="status-badge status-active">Active</span>
                      </div>
                    </div>
                    
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-fan"></i>
                      </div>
                      <h4>Air Compressor</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">PM-0045</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Last Inspection:</span>
                          <span class="info-value">2023-10-28</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Next Due:</span>
                          <span class="info-value">2024-01-28</span>
                        </div>
                        <span class="status-badge status-active">Active</span>
                      </div>
                    </div>
                    
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-droplet"></i>
                      </div>
                      <h4>Water Pump</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">PM-0056</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Last Inspection:</span>
                          <span class="info-value">2023-11-15</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Next Due:</span>
                          <span class="info-value">2024-02-15</span>
                        </div>
                        <span class="status-badge status-inactive">Inactive</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="sheet-container">
                    <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRxgJP6jRVZLno0cG-6AcOwveisbYHeKTXWZY2tmQ6q2GZVomVFFtIQvVxbZVoKhw/pubhtml?gid=348565325&single=true"
                            allowfullscreen title="Power Machines Log"></iframe>
                  </div>
                </div>
                
                <div class="tab-pane fade" id="fire-extinguishers" role="tabpanel">
                  <h3>Fire Safety Equipment</h3>
                  <div class="equipment-grid">
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-fire"></i>
                      </div>
                      <h4>CO2 Extinguisher</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">FE-0011</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Location:</span>
                          <span class="info-value">Rest Area</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Expiry:</span>
                          <span class="info-value">2024-06-15</span>
                        </div>
                        <span class="status-badge status-active">Active</span>
                      </div>
                    </div>
                    
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-fire"></i>
                      </div>
                      <h4>Foam Extinguisher</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">FE-0033</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Location:</span>
                          <span class="info-value">Workshop</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Expiry:</span>
                          <span class="info-value">2024-05-30</span>
                        </div>
                        <span class="status-badge status-active">Active</span>
                      </div>
                    </div>
                    
                    <div class="equipment-item">
                      <div class="equipment-icon">
                        <i class="bi bi-fire"></i>
                      </div>
                      <h4>Dry Powder Extinguisher</h4>
                      <div class="equipment-info">
                        <div class="info-item">
                          <span class="info-label">ID:</span>
                          <span class="info-value">FE-0055</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Location:</span>
                          <span class="info-value">Storage Area</span>
                        </div>
                        <div class="info-item">
                          <span class="info-label">Expiry:</span>
                          <span class="info-value">2023-12-10</span>
                        </div>
                        <span class="status-badge status-maintenance">Requires Service</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="sheet-container">
                    <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRxgJP6jRVZLno0cG-6AcOwveisbYHeKTXWZY2tmQ6q2GZVomVFFtIQvVxbZVoKhw/pubhtml?gid=71846233&single=true"
                            allowfullscreen title="Fire Extinguishers Log"></iframe>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- About Me Tab -->
          <div class="tab-pane fade" id="aboutme" role="tabpanel">
            <div class="text-center mb-5">
              <div class="profile-img">
                <img src="El1.jpg" alt="Profile Photo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
              </div>
              <h2>ELIUS D.A</h2>
              <h5 class="text-muted">HSE Professional & Developer</h5>
              <div class="social-links">
                <a href="https://wa.me/971552623327" class="btn btn-outline-success" target="_blank">
                  <i class="bi bi-whatsapp me-2"></i>WhatsApp
                </a>
                <a href="mailto:niwamanyaelius95@gmail.com" class="btn btn-outline-primary" target="_blank">
                  <i class="bi bi-envelope me-2"></i>Email
                </a>
                <a href="https://www.linkedin.com/in/elius-niwamanya-026228187/" class="btn btn-outline-primary" target="_blank">
                  <i class="bi bi-linkedin me-2"></i>LinkedIn
                </a>
              </div>
            </div>
            
            <div class="row g-4">
              <div class="col-md-6">
                <div class="card h-100">
                  <div class="card-body">
                    <h4 class="card-title mb-3"><i class="bi bi-person-lines-fill me-2"></i>Professional Profile</h4>
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                        Lifting Supervisor
                      </li>
                      <li class="list-group-item d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                        HSE Inspection Specialist
                      </li>
                      <li class="list-group-item d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                        Full-Stack Developer
                      </li>
                      <li class="list-group-item d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                        Cybersecurity Enthusiast
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card h-100">
                  <div class="card-body">
                    <h4 class="card-title mb-3"><i class="bi bi-info-circle-fill me-2"></i>Contact Information</h4>
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item">
                        <i class="bi bi-telephone-fill me-2 text-primary"></i>
                        +971 55 262 3327
                      </li>
                      <li class="list-group-item">
                        <i class="bi bi-envelope-fill me-2 text-primary"></i>
                        niwamanyaelius95@gmail.com
                      </li>
                      <li class="list-group-item">
                        <i class="bi bi-geo-alt-fill me-2 text-primary"></i>
                        Dubai, UAE
                      </li>
                      <li class="list-group-item">
                        <i class="bi bi-briefcase-fill me-2 text-primary"></i>
                        HSE Professional since 2018
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark/light mode">
    <i class="bi bi-moon-fill"></i>
  </button>

  <!-- Image Modal -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="imageModalLabel">Image Preview</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <img id="modalImage" src="" alt="Preview" class="img-fluid" style="max-height: 70vh;">
        </div>
        <div class="modal-footer">
          <a id="downloadImage" href="#" class="btn btn-primary" download>
            <i class="bi bi-download"></i> Download
          </a>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Initialize image modal
    document.addEventListener('DOMContentLoaded', function() {
      const imageModal = document.getElementById('imageModal');
      if (imageModal) {
        imageModal.addEventListener('show.bs.modal', function(event) {
          const button = event.relatedTarget;
          const imageUrl = button.getAttribute('data-img');
          const modalImage = document.getElementById('modalImage');
          const downloadLink = document.getElementById('downloadImage');
          
          if (modalImage && downloadLink) {
            modalImage.src = imageUrl;
            downloadLink.href = imageUrl;
            downloadLink.download = imageUrl.split('/').pop() || 'inspection_image.jpg';
          }
        });
      }
    });
  </script>
  <script>
    // Theme Toggle Functionality
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle.querySelector('i');
    const html = document.documentElement;

    // Check for saved theme preference or use preferred color scheme
    const savedTheme = localStorage.getItem('theme') || 
                      (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    
    // Apply saved theme
    html.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);

    // Toggle theme on button click
    themeToggle.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    });

    // Update theme icon based on current theme
    function updateThemeIcon(theme) {
      if (theme === 'dark') {
        themeIcon.className = 'bi bi-sun-fill';
        themeIcon.setAttribute('title', 'Switch to light mode');
      } else {
        themeIcon.className = 'bi bi-moon-fill';
        themeIcon.setAttribute('title', 'Switch to dark mode');
      }
    }

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (!localStorage.getItem('theme')) { // Only if user hasn't set a preference
        const newTheme = e.matches ? 'dark' : 'light';
        html.setAttribute('data-theme', newTheme);
        updateThemeIcon(newTheme);
      }
    });

    // Handle Responsible Engineer dropdown change (Global scope)
    function handleResponsibleChange() {
      const responsibleSelect = document.getElementById('responsible');
      const customInput = document.getElementById('customResponsible');
      
      if (responsibleSelect.value === 'write_custom') {
        customInput.style.display = 'block';
        customInput.required = true;
        customInput.focus();
      } else {
        customInput.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
    }
    
    // Add custom responsible engineer name (Global scope)
    function addCustomResponsibleName(name) {
      if (!name || name.trim() === '') return;
      
      const responsibleSelect = document.getElementById('responsible');
      const customInput = document.getElementById('customResponsible');
      
      // Get existing custom names from localStorage
      let customNames = JSON.parse(localStorage.getItem('customResponsibleNames')) || [];
      
      // Add new name if it doesn't exist
      if (!customNames.includes(name.trim())) {
        customNames.push(name.trim());
        localStorage.setItem('customResponsibleNames', JSON.stringify(customNames));
        
        // Add option to dropdown (before 'Write name' option)
        const writeOption = responsibleSelect.querySelector('option[value="write_custom"]');
        const newOption = document.createElement('option');
        newOption.value = name.trim();
        newOption.textContent = name.trim();
        responsibleSelect.insertBefore(newOption, writeOption);
      }
      
      // Select the new name
      responsibleSelect.value = name.trim();
      customInput.style.display = 'none';
      customInput.required = false;
      customInput.value = '';
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Initialize date field with current date
      document.getElementById('date').value = new Date().toISOString().split('T')[0];
      
      // DOM elements
      const inspectorSelect = document.getElementById('inspector');
      const observationsList = document.getElementById('observationsList');
      const exportBtn = document.getElementById('exportObservations');
      const authContainer = document.getElementById('authContainer');
      const assessorManagement = document.getElementById('assessorManagement');
      
      // Data storage
      let assessorData = {};
      console.log('Loading observations from localStorage...');
      let observations = JSON.parse(localStorage.getItem('hseObservations')) || [];
      console.log('Loaded observations:', observations);
      
      // Chart instances
      let riskChart = null;
      let inspectorChart = null;
      
      // Load saved observations
      console.log('Calling renderObservations...');
      renderObservations();
      
      // Load saved assessor data if exists
      const savedAssessorData = localStorage.getItem('assessorData');
      if (savedAssessorData) {
        assessorData = JSON.parse(savedAssessorData);
        // Hide auth container and show assessor management
        if (authContainer) authContainer.style.display = 'none';
        if (assessorManagement) assessorManagement.style.display = 'block';
        
        // Update inspector dropdown
        if (inspectorSelect && assessorData.name) {
          inspectorSelect.innerHTML = `
            <option disabled selected value="">Select Inspector</option>
            <option selected value="${assessorData.name}">${assessorData.name}</option>
          `;
        }
      }
      
      // Note: Login form removed - using direct assessor management
      
      // Google Sheets Integration
      async function saveToGoogleSheets(observation) {
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyPadf51ZIjbACU9_7xhyhbZkUu2IggVms7stHQI47eApEC12DLSNYn6kzBn70fsuna/exec';
        
        try {
          // Prepare data for Google Sheets
          const rowData = [
            new Date(observation.timestamp).toLocaleString(),
            observation.date,
            observation.inspector,
            observation.location,
            observation.risk,
            observation.responsible,
            observation.observation,
            observation.photos.length,
            observation.assessor?.name || 'Unknown',
            observation.id
          ];
          
          // Send data to Google Sheets via Apps Script
          const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ rowData: rowData })
          });
          
          if (response.ok) {
            console.log('‚úÖ Inspection data successfully saved to Google Sheets!');
            // Show success notification to user
            showNotification('Data saved to Google Sheets successfully!', 'success');
          } else {
            throw new Error('Failed to save to Google Sheets');
          }
          
        } catch (error) {
          console.log('‚ùå Error saving to Google Sheets:', error);
          showNotification('Local save successful, but Google Sheets sync failed', 'warning');
        }
      }
      
      // Show notification to user
      function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 5000);
      }
      
      // Load custom responsible engineer names on page load
      function loadCustomResponsibleNames() {
        const responsibleSelect = document.getElementById('responsible');
        const customNames = JSON.parse(localStorage.getItem('customResponsibleNames')) || [];
        
        // Add custom names to dropdown
        const writeOption = responsibleSelect.querySelector('option[value="write_custom"]');
        customNames.forEach(name => {
          const option = document.createElement('option');
          option.value = name;
          option.textContent = name;
          responsibleSelect.insertBefore(option, writeOption);
        });
      }
      
      // Setup custom input event listeners
      const customInput = document.getElementById('customResponsible');
      if (customInput) {
        customInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            addCustomResponsibleName(this.value);
          }
        });
        
        customInput.addEventListener('blur', function() {
          if (this.value.trim()) {
            addCustomResponsibleName(this.value);
          }
        });
      }
      
      // Load existing custom names
      loadCustomResponsibleNames();
      
      // Note: Assessor form uses saveAssessorInfo() function called by button onclick
      
      // HSE Form Submission
      document.getElementById('hseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Form validation
        const requiredFields = ['location', 'date', 'risk', 'responsible', 'inspector', 'observation'];
        for (const field of requiredFields) {
          if (!document.getElementById(field).value.trim()) {
            alert(`Please fill in the ${field} field`);
            return;
          }
        }
        
        const photoFiles = Array.from(document.getElementById('photo').files);
        if (photoFiles.length > 5) {
          alert('Maximum 5 photos allowed');
          return;
        }
        
        // Create observation object with form fields
        const obs = {
          id: Date.now(),
          location: document.getElementById('location').value.trim(),
          date: document.getElementById('date').value,
          risk: document.getElementById('risk').value,
          responsible: document.getElementById('responsible').value,
          inspector: document.getElementById('inspector').value,
          observation: document.getElementById('observation').value.trim(),
          photos: photoFiles.map(f => ({ 
            name: f.name, 
            url: URL.createObjectURL(f),
            size: (f.size / (1024 * 1024)).toFixed(2) + 'MB'
          })),
          timestamp: new Date().toISOString(),
          assessor: assessorData || {}
        };
        
        console.log('Creating observation:', obs);
        
        // Add to observations array
        observations.unshift(obs);
        console.log('Observations array after adding:', observations);
        
        // Save to localStorage
        localStorage.setItem('hseObservations', JSON.stringify(observations));
        console.log('Saved to localStorage:', localStorage.getItem('hseObservations'));
        
        // Save to Google Sheets
        saveToGoogleSheets(obs);
        
        // Render updated list
        renderObservations();
        
        // Reset form
        this.reset();
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        alert('Inspection report submitted successfully!');
      });
      
      // Export Observations
      exportBtn.addEventListener('click', function() {
        if (observations.length === 0) {
          alert('No observations to export');
          return;
        }
        
        // Convert to CSV
        const headers = ['ID', 'Date', 'Location', 'Risk', 'Inspector', 'Responsible', 'Observation'];
        const csvRows = [
          headers.join(','),
          ...observations.map(obs => 
            [
              obs.id,
              obs.date,
              `"${obs.location.replace(/"/g, '""')}"`,
              obs.risk,
              `"${obs.inspector}"`,
              `"${obs.responsible}"`,
              `"${obs.observation.replace(/"/g, '""')}"`
            ].join(',')
          )
        ];
        
        const csvContent = csvRows.join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `hse_observations_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
      
      // Render observations function
      function renderObservations() {
        if (observations.length === 0) {
          observationsList.innerHTML = `
            <div class="col-12 text-center py-5">
              <i class="bi bi-info-circle" style="font-size: 3rem; color: #6c757d;"></i>
              <h4 class="mt-3">No observations found</h4>
              <p class="text-muted">Submit your first inspection report to see it here</p>
            </div>
          `;
          
          // Update counters
          updateCounters();
          renderCharts();
          return;
        }
        
        observationsList.innerHTML = observations.map(obs => `
          <div class="col-md-6 col-lg-4">
            <div class="card observation-card h-100">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  ${obs.assessor && obs.assessor.photoURL ? `
                    <img src="${obs.assessor.photoURL}" alt="Assessor" 
                         class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;">
                  ` : '<div class="rounded-circle bg-secondary me-3" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;"><i class="bi bi-person text-white"></i></div>'}
                  <div>
                    <h5 class="card-title mb-0">${obs.inspector}</h5>
                    <small class="text-muted">${obs.assessor && obs.assessor.position ? obs.assessor.position : 'Inspector'}</small>
                  </div>
                </div>
                
                <div class="mb-3">
                  <span class="badge bg-${getRiskColor(obs.risk)} me-2">${obs.risk} Risk</span>
                  <span class="badge bg-secondary">${formatDate(obs.date)}</span>
                </div>
                
                <div class="row g-2 mb-3">
                  <div class="col-md-6">
                    <p class="card-text mb-1"><strong><i class="bi bi-geo-alt me-2"></i>Location:</strong></p>
                    <p class="text-muted ms-3">${obs.location}</p>
                  </div>
                  <div class="col-md-6">
                    <p class="card-text mb-1"><strong><i class="bi bi-person-vcard me-2"></i>Responsible Engineer:</strong></p>
                    <p class="text-muted ms-3">${obs.responsible}</p>
                  </div>
                  <div class="col-12">
                    <p class="card-text mb-1"><strong><i class="bi bi-chat-square-text me-2"></i>Observation:</strong></p>
                    <p class="text-muted ms-3">${obs.observation}</p>
                  </div>
                </div>
                
                ${obs.photos && obs.photos.length > 0 ? `
                  <div class="mt-3">
                    <p class="small text-muted mb-2">Attachments (${obs.photos.length})</p>
                    <div class="d-flex flex-wrap">
                      ${obs.photos.map(photo => {
                        const isImage = /.(jpg|jpeg|png|gif|webp)$/i.test(photo.name);
                        const fileName = photo.name.length > 15 ? photo.name.substring(0, 12) + '...' : photo.name;
                        
                        return `
                        <div class="img-preview-container" title="${photo.name}">
                          <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#imageModal" data-img="${photo.url}">
                            ${isImage ? 
                              `<img src="${photo.url}" alt="Preview" class="img-preview">` : 
                              `<div class="file-preview">
                                <i class="bi bi-file-earmark-text text-primary" style="font-size: 2rem;"></i>
                                <small class="text-truncate mt-1">${fileName}</small>
                              </div>`
                            }
                          </a>
                          <small class="position-absolute bottom-0 start-0 end-0 text-center bg-dark bg-opacity-75 text-white py-1">
                            ${photo.size}
                          </small>
                        </div>
                      `;}).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
              <div class="card-footer bg-transparent border-top">
                <small class="text-muted">Reported at ${formatTime(obs.timestamp)}</small>
              </div>
            </div>
          </div>
        `).join('');
        
        // Force reflow for animation
        document.querySelectorAll('.observation-card').forEach((card, index) => {
          setTimeout(() => {
            card.style.animationDelay = `${index * 0.1}s`;
          }, 10);
        });
        
        // Update counters and charts
        updateCounters();
        renderCharts();
      }
      
      // Update statistics counters
      function updateCounters() {
        document.getElementById('totalObservations').textContent = observations.length;
        
        const highRiskCount = observations.filter(obs => obs.risk === 'High').length;
        const mediumRiskCount = observations.filter(obs => obs.risk === 'Medium').length;
        const lowRiskCount = observations.filter(obs => obs.risk === 'Low').length;
        
        document.getElementById('highRiskCount').textContent = highRiskCount;
        document.getElementById('mediumRiskCount').textContent = mediumRiskCount;
        document.getElementById('lowRiskCount').textContent = lowRiskCount;
      }
      
      // Render charts
      function renderCharts() {
        // Destroy existing charts if they exist
        if (riskChart) riskChart.destroy();
        if (inspectorChart) inspectorChart.destroy();
        
        // Prepare data for risk chart
        const riskCounts = {
          High: 0,
          Medium: 0,
          Low: 0
        };
        
        observations.forEach(obs => {
          riskCounts[obs.risk]++;
        });
        
        // Prepare data for inspector chart
        const inspectorCounts = {};
        observations.forEach(obs => {
          const inspector = obs.inspector || 'Unknown';
          inspectorCounts[inspector] = (inspectorCounts[inspector] || 0) + 1;
        });
        
        const inspectors = Object.keys(inspectorCounts);
        const inspectorValues = Object.values(inspectorCounts);
        
        // Get colors based on theme
        const bgColor = html.getAttribute('data-theme') === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)';
        const borderColor = html.getAttribute('data-theme') === 'dark' ? '#64b5f6' : '#1976d2';
        const textColor = html.getAttribute('data-theme') === 'dark' ? '#f0f0f0' : '#1a1a1a';
        
        // Create risk chart
        const riskCtx = document.getElementById('riskChart').getContext('2d');
        riskChart = new Chart(riskCtx, {
          type: 'doughnut',
          data: {
            labels: ['High Risk', 'Medium Risk', 'Low Risk'],
            datasets: [{
              data: [riskCounts.High, riskCounts.Medium, riskCounts.Low],
              backgroundColor: [
                'rgba(220, 53, 69, 0.7)',
                'rgba(255, 193, 7, 0.7)',
                'rgba(40, 167, 69, 0.7)'
              ],
              borderColor: [
                'rgba(220, 53, 69, 1)',
                'rgba(255, 193, 7, 1)',
                'rgba(40, 167, 69, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: {
                  color: textColor
                }
              }
            }
          }
        });
        
        // Create inspector chart
        const inspectorCtx = document.getElementById('inspectorChart').getContext('2d');
        inspectorChart = new Chart(inspectorCtx, {
          type: 'bar',
          data: {
            labels: inspectors,
            datasets: [{
              label: 'Reports Submitted',
              data: inspectorValues,
              backgroundColor: 'rgba(25, 118, 210, 0.7)',
              borderColor: 'rgba(25, 118, 210, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: textColor
                },
                grid: {
                  color: bgColor
                }
              },
              x: {
                ticks: {
                  color: textColor
                },
                grid: {
                  color: bgColor
                }
              }
            },
            plugins: {
              legend: {
                labels: {
                  color: textColor
                }
              }
            }
          }
        });
      }
      
      // Helper functions
      function getRiskColor(risk) {
        switch (risk.toLowerCase()) {
          case 'high': return 'danger';
          case 'medium': return 'warning';
          default: return 'success';
        }
      }
      
      function formatDate(dateString) {
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
      }
      
      function formatTime(dateString) {
        const options = { hour: '2-digit', minute: '2-digit' };
        return new Date(dateString).toLocaleTimeString(undefined, options);
      }
      
      // Load saved assessor if exists
      const savedAssessor = localStorage.getItem('hseAssessor');
      if (savedAssessor) {
        assessorData = JSON.parse(savedAssessor);
        inspectorSelect.innerHTML = `
          <option disabled selected value="">Select Inspector</option>
          <option selected value="${assessorData.name}">${assessorData.name}</option>
        `;
      }
    });
  </script>
</body>
</html>
